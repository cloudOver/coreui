<div class="modal fade" id="vmCreateModal" tabindex="-1" role="dialog" aria-labelledby="vmCreateLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button onclick="$('#vmCreateModal').modal('hide')" type="button" class="close"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="vmCreateLabel">Create new vm</h4>
            </div>
            <div class="modal-body">
                <form id="vmForm" role="form">
                    <div class="form-group">
                        <label for="vmName">Virtual machine name: </label><input type="text" id="vmName" class="form-control">
                        <br/>
                        <textarea id="vmDescription" class="form-control input-sm" placeholder="Optional description"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="vmTemplate">Template:</label><br/>
                                <select class="form-control" id="vmTemplate"></select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="vmImage">Base virtual drive:</label><br/>
                                <select class="form-control" id="vmImage"></select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12"><a href="#vm_create" onclick="$('#vmMore').toggle(300)">More...</a></div>
                    </div>
                    <div class="row" id="vmMore">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="vmLeases">Network leases:</label><br/>
                                <select multiple class="form-control" id="vmLeases"></select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="vmDisks">Additional, permanent disks:</label><br/>
                                <select multiple class="form-control" id="vmDisks"></select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" onclick="$('#vmCreateModal').modal('hide')">Cancel</button>
                <button id="vmSubmit" type="button" class="btn btn-primary">Create</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $("#vmCreateModal").find("#vmSubmit").click(function(e) {
        modal = "#vmCreateModal";
        name = $(modal).find("#vmName").val();
        description = $(modal).find("#vmDescription").val();
        template_id = $(modal).find("#vmTemplate").val();
        base_image_id = $(modal).find("#vmImage").val();

        request('/api/vm/create/', {token: window.token,
                    name: name,
                    description: description,
                    template_id: template_id,
                    base_image_id: base_image_id},
                function(r) {
                    $(modal).find("#vmLeases option:selected").each(function() {
                        request("/api/network/attach/", {token: window.token, vm_id: r["id"], lease_id: $(this).val()}, function(r) {});
                    });
                    $(modal).find("#vmDisks option:selected").each(function() {
                        request("/api/image/attach/", {token: window.token, vm_id: r["id"], image_id: $(this).val()}, function(r) {});
                    });
                    $(modal).find("#vmForm")[0].reset();
                });
        showVmList();
        $(modal).modal('hide');
    });
    $('#vmMore').toggle(1);
</script>