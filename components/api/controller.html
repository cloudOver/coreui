<div id="modals"></div>

<script type="text/javascript">
    $("#modals").append($("<div>").load("components/api/modals/image_upload.html"));
    $("#modals").append($("<div>").load("components/api/modals/image_create.html"));
    $("#modals").append($("<div>").load("components/api/modals/network_create.html"));
    $("#modals").append($("<div>").load("components/api/modals/vm_create.html"));

    /// VM Tab

    function showVmList() {
        highlightMenu("#vm_list");
        request("/api/vm/get_list/", {token: window.token}, function(r) {
            makeTable(new TableCoreModel(r, ["name", "description"], "vm"));
            refreshContent("showVmList()");
        });
    }

    function showTemplateList() {
        highlightMenu("#template_list");
        clearTimeout(window.refresh_timeout);
        request("/api/template/get_list/", {token: window.token}, function(r) {
            makeTable(new TableCoreModel(r, ["name", "domain_type", "cpu", "memory", "points"], "template"));
        });
    }

    function showVmCreate() {
        highlightMenu("#vm_create");
        showVmList();
        modal = "#vmCreateModal";
        $(modal).on('show.bs.modal', function(e) {
            request('/api/template/get_list/', {token: window.token}, function (r) {
                fillSelect(new SelectCoreModel(r, "name"), modal, "#vmTemplate");
            });
            request('/api/image/get_list/', {token: window.token}, function (r) {
                fillSelect(new SelectCoreModel(r, "name"), modal, "#vmImage");
            });
        });
        $(modal).modal('show');
    }

    /// Image Tab

    function showImageList() {
        highlightMenu("#image_list");
        request("/api/image/get_list/", {token: window.token}, function(r) {
            makeTable(new TableCoreModel(r, ["id", "name", "description", "size", "state"], "image"));
            refreshContent("showImageList()");
        });
    }

    function showImageCreate() {
        highlightMenu("#image_create");
        showImageList();
        modal = "#imageCreateModal";
        $(modal).on('show.bs.modal', function(e) {
            request('/api/image/get_image_formats/', {token: window.token}, function (r) {
                fillSelect(new SelectListModel(r), modal, "#imageFormat");
            });
            request('/api/image/get_image_types/', {token: window.token}, function (r) {
                fillSelect(new SelectListModel(r), modal, "#imageType");
            });
            request('/api/image/get_disk_controllers/', {token: window.token}, function (r) {
                fillSelect(new SelectListModel(r), modal, "#imageDiskController");
            });
        });
        $(modal).modal('show');
    }

    function showImageUpload() {
        highlightMenu("#image_upload");
        showImageList();
        modal = "#imageUploadModal";
        $(modal).on('show.bs.modal', function(e) {
            request('/api/image/get_image_formats/', {token: window.token}, function (r) {
                fillSelect(new SelectListModel(r), modal, "#imageFormat");
            });
            request('/api/image/get_image_types/', {token: window.token}, function (r) {
                fillSelect(new SelectListModel(r), modal, "#imageType");
            });
            request('/api/image/get_disk_controllers/', {token: window.token}, function (r) {
                fillSelect(new SelectListModel(r), modal, "#imageDiskController");
            });
        });
        $(modal).modal('show');
    }

    /// Network Tab

    function showNetworkList() {
        highlightMenu("#network_list");
        clearTimeout(window.refresh_timeout);
        request("/api/network/list_user_networks/", {token: window.token}, function(r) {
            makeTable(new TableCoreModel(r, ["id", "name", "address", "mask"], "network"));
        });
    }

    function showNetworkCreate() {
        highlightMenu("#network_create");
        showNetworkList();
        modal = "#networkCreateModal";
        $(modal).modal('show');
    }



    $("#vm_list").click(function(e) { showVmList(); });
    $("#template_list").click(function(e) { showTemplateList(); });
    $("#vm_create").click(function(e) { showVmCreate() });

    $("#image_list").click(function(e) { showImageList() });
    $("#image_create").click(function(e) { showImageCreate() });
    $("#image_upload").click(function(e) { showImageUpload() });

    $("#network_list").click(function(e) { showNetworkList() });
    $("#network_create").click(function(e) { showNetworkCreate() });
</script>
