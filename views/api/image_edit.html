<!--
Copyright (c) 2014-2016 cloudover.io ltd.

This file is part of CloudOver project.

cloudover.coreCluster is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->


<div class="ui container">
    <div class="ui segment">
        <div class="ui three column grid">
            <div class="column">
                <div class="ui icon header">
                    <i class="disk outline icon"></i>
                    {{ image.name }}
                </div>
            </div>
            <div class="column">
                <div class="meta">ID: {{ image.id }}</div>
                <div class="meta">Size: {{ image.size }}</div>
                <div class="meta">State:
                    <i ng-show="image.state == 'waiting'" class="blue settings icon"></i>
                    <i ng-show="image.state == 'failed'" class="red remove icon"></i>
                    <i ng-show="image.state == 'downloading'" class="green cloud upload icon"></i>
                    <i ng-show="image.state == 'ok'" class="green checkmark icon"></i>
                    {{ obj.state }}
                </div>
                <div class="divider"></div>
                <div class="meta">Created: {{ image.creation_date }}</div>
                <div class="meta">Format: {{ image.format }}</div>
            </div>
            <div class="right aligned column">
                <button class="ui red image button" ng-click="imageRemove()"><i class="remove icon"></i> Remove</button>
            </div>
        </div>
    </div>

    <div class="ui styled fluid accordion">
        <div class="title active">
            <i class="dropdown icon"></i>
            Basic information
        </div>
        <div class="content active">
            <p style="display: block ! important;" class="transition visible">
                <div class="ui two column grid">
                    <div class="ui column form">
                        <div class="field">
                            <div class="ui left icon input">
                                <i class="edit icon"></i>
                                <input type="text" ng-model="image.name" placeholder="Image name">
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui left icon input">
                                <i class="edit icon"></i>
                                <textarea rows=4 ng-model="image.description" placeholder="Description"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="ui column">
                        <div class="ui header" ng-show="image.attached_to_id">
                            Attached as external drive to instance {{ image.attached_to }}
                            <button class="ui red button" ng-click="imageDetach(image.attached_to_id, image.id)">Detach</button>
                        </div>
                    </div>
                </div>
            </p>
        </div>

        <div class="title active">
            <i class="dropdown icon"></i>
            Advanced
        </div>
        <div class="content">
            <p style="display: block ! important;" class="transition visible">
                Here you can modify advanced parameters of your image. Access mode defines who can use this image (attach as external drive
                or start new instance. The <em>type</em> parameter defines  how this image couls be used. Images with transient type could be
                used as base image for new instances. Permanent images could be used as external drives.<br/>
                The <em>disk controller</em>, <em>network device</em> and <em>graphics card</em> define how virtualizator should emulate
                hardware for all instances booted from this image (as base image). Various operating systems may have no support for
                some of drivers. Select one of drivers to emulate proper hardware in all instances booted with this image. Note, that
                some drivers may be emulated slower than another. Usually selecting virtio drivers is the best option for Linux operating
                systems. This settings have no influence when image is attached as external drive.
                <div class="ui three column grid">
                    <div class="ui column form">
                        <div class="grouped fields">
                            <label>Access: </label>
                            <div class="field">
                                <div class="ui slider checkbox">
                                    <input type="radio" name="access" ng-model="image.access" value="private"/>
                                    <label>Private</label>
                                </div>
                            </div>
                            <div class="field">
                                <div class="ui slider checkbox">
                                    <input type="radio" name="access" ng-model="image.access" value="group"/>
                                    <label>Group</label>
                                </div>
                            </div>
                            <div class="field">
                                <div class="ui slider checkbox">
                                    <input type="radio" name="access" ng-model="image.access" value="public"/>
                                    <label>Public</label>
                                </div>
                            </div>
                        </div>
                        <div class="grouped fields">
                            <label>Type: </label>
                            <div class="field" data-ng-repeat="type in types">
                                <div class="ui slider checkbox">
                                    <input type="radio" name="type" ng-model="image.type" value="{{ type }}"/>
                                    <label>{{ type }}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui column form">
                        <div class="grouped fields">
                            <label>Network device</label>
                            <div class="field" data-ng-repeat="network_device in network_devices">
                                <div class="ui slider checkbox">
                                    <input type="radio" name="network_device" ng-model="$parent.image.network_device" ng-value="network_device" />
                                    <label>{{ network_device }}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui column form">
                        <div class="grouped fields">
                            <label>Disk controller</label>
                            <div class="field" data-ng-repeat="disk_controller in disk_controllers">
                                <div class="ui slider checkbox">
                                    <input type="radio" name="disk_controller" ng-model="image.disk_controller" value="{{ disk_controller }}"/>
                                    <label>{{ disk_controller }}</label>
                                </div>
                            </div>
                        </div>
                        <div class="grouped fields">
                            <label>Graphics card {{ image.video_device }}</label>
                            <div class="field" ng-repeat="video_device in video_devices">
                                <div class="ui slider checkbox">
                                    <input type="radio" name="video_device" ng-model="image.video_device" ng-value="video_device"/>
                                    <label>{{ video_device }}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </p>
        </div>

        <div class="title active">
            <i class="dropdown icon"></i>
            Task queue
        </div>
        <div class="content" id="tasks">
            <p style="display: block ! important;" class="transition visible">
                <table class="ui table">
                    <thead>
                        <th>Type</th>
                        <th>Action</th>
                        <th>State</th>
                    </thead>
                    <tr data-ng-repeat="task in image.tasks" ng-class="{danger: task.state=='failed', success: task.state=='in progress', warning: task.state=='waiting'}">
                        <td>{{task.type}}</td>
                        <td>{{task.action}}</td>
                        <td ng-show="task.action != 'upload_url'">{{task.state}}</td>
                        <td ng-show="task.action == 'upload_url'">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" aria-valuenow="44" aria-valuemin="0" aria-valuemax="100" ng-attr-style="width: {{image.data.progress*100}}%">
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
                <div id="task_graph" style="height: 100%; border: 1px #4f4f4f solid; width: 100%;"></div>
            </p>
        </div>
    </div>
    <div class="ui two bottom attached buttons">
        <a class="ui yellow icon button" href="#/api/image/"><i class="left arrow icon"></i>Back</a>
        <button class="ui green icon button" ng-click="imageSave()"><i class="checkmark icon"></i>Save</button>
    </div>
</div>

<script>
    $('.ui.accordion').accordion();
</script>
